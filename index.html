<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Malla - Ingeniería Mecánica</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }
    .semestre {
      margin-bottom: 40px;
    }
    .semestre h2 {
      color: #333;
      border-bottom: 2px solid #ccc;
    }
    .materia {
      border: 2px solid #ccc;
      background: white;
      border-radius: 8px;
      padding: 10px;
      margin: 10px 0;
      width: 300px;
      cursor: pointer;
      transition: 0.3s;
    }
    .materia.vista {
      background: #0077cc;
      color: white;
    }
    .materia.habilitada:not(.vista) {
      border-color: green;
      background: #eaffea;
    }
    .materia.no-disponible {
      opacity: 0.5;
    }
    #reset {
      margin-bottom: 30px;
      padding: 10px 15px;
      border: none;
      background: #cc0000;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
    #reset:hover {
      background: #990000;
    }
  </style>
</head>
<body>
  <h1>Malla Interactiva - Ingeniería Mecánica</h1>
  <button id="reset">Reiniciar selección</button>
  <div id="contenedor"></div>

  <script>
    // Aquí pegamos directamente las materias
    const materias = [
      {
  "codigo": "001295",
  "nombre": "Calculo Diferencial",
  "creditos": 3,
  "prerequisitos": [],
  "semestre": 1
},
{
  "codigo": "001290",
  "nombre": "Álgebra Lineal",
  "creditos": 3,
  "prerequisitos": [],
  "semestre": 1
},
{
  "codigo": "033698",
  "nombre": "Introducción a la programación",
  "creditos": 3,
  "prerequisitos": [],
  "semestre": 1
},
{
  "codigo": "033763",
  "nombre": "Introducción a la Ingeniería",
  "creditos": 2,
  "prerequisitos": [],
  "semestre": 1
},
{
  "codigo": "001138",
  "nombre": "Química Materiales",
  "creditos": 3,
  "prerequisitos": [],
  "semestre": 1
},
{
  "codigo": "033735",
  "nombre": "Innovación y diseño de producto",
  "creditos": 2,
  "prerequisitos": [],
  "semestre": 1
}
    ];

    let materiasVistas = JSON.parse(localStorage.getItem("materiasVistas") || "[]");

    function guardarVistas() {
      localStorage.setItem("materiasVistas", JSON.stringify(materiasVistas));
    }

    function puedeVer(materia) {
      return materia.prerequisitos.every(pr => materiasVistas.includes(pr));
    }

    document.getElementById("reset").addEventListener("click", () => {
      if (confirm("¿Estás seguro de borrar todas las materias vistas?")) {
        localStorage.removeItem("materiasVistas");
        location.reload();
      }
    });

    const materiasPorSemestre = {};
    const materiasPorCodigo = {};

    materias.forEach(m => {
      materiasPorSemestre[m.semestre] = materiasPorSemestre[m.semestre] || [];
      materiasPorSemestre[m.semestre].push(m);
      materiasPorCodigo[m.codigo] = m;
    });

    const contenedor = document.getElementById("contenedor");

    Object.keys(materiasPorSemestre).sort((a, b) => a - b).forEach(sem => {
      const bloque = document.createElement("div");
      bloque.className = "semestre";
      const titulo = document.createElement("h2");
      titulo.textContent = `Semestre ${sem}`;
      bloque.appendChild(titulo);

      materiasPorSemestre[sem].forEach(m => {
        const div = document.createElement("div");
        div.className = "materia";
        div.innerHTML = `
          <strong>${m.nombre}</strong><br/>
          Código: ${m.codigo}<br/>
          Créditos: ${m.creditos}<br/>
          Prerrequisitos: ${m.prerequisitos.length ? m.prerequisitos.join(", ") : "Ninguno"}
        `;

        const yaVista = materiasVistas.includes(m.codigo);
        const habilitada = puedeVer(m);

        if (yaVista) div.classList.add("vista");
        else if (habilitada) div.classList.add("habilitada");
        else div.classList.add("no-disponible");

        div.addEventListener("click", () => {
          if (materiasVistas.includes(m.codigo)) {
            materiasVistas = materiasVistas.filter(c => c !== m.codigo);
          } else if (habilitada || m.prerequisitos.length === 0) {
            materiasVistas.push(m.codigo);
          }
          guardarVistas();
          location.reload();
        });

        bloque.appendChild(div);
      });

      contenedor.appendChild(bloque);
    });
  </script>
</body>
</html>
